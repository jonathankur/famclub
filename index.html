<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="mobile-web-app-capable" content="yes">
	<title>Fam Club</title>
 <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
	<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Open+Sans:300,400,700">
	<script src="phonegap.js"></script>
      <script src="http://code.jquery.com/jquery-1.11.2.min.js"></script>
	<script src="jquery.mobile-1.4.5.min.js"></script>
	<script>

// var cols = [[102,255,255],[153,255,153],[255,255,153],[255,153,153],[255,153,255],[153,204,255]];
var cols=[[204,255,255],[204,204,255],[255,204,255],[255,204,204],[255,255,204],[204,255,204]]; 
var curback = 0, curnext=1;
var rat=0.00;

var fbLoginSuccess = function (userData) {
  url='http://famclub.com.au/facebook.php?user='+userData.authResponse.userID+'&access='+userData.authResponse.accessToken;
  alert(url);
  $.ajax({url: url, 
    success : function(result) {
       alert('logged in');
    }
  });

}
 

function dofacebooklogin()
{
facebookConnectPlugin.login(["public_profile", "email"], fbLoginSuccess,
  function (error) {
    alert("ERROR: "+JSON.stringify(error))
  }
);
}

function setback()
{ var rr = 1-rat;
  var r = Math.floor(cols[curback][0] * rr + rat * cols[curnext][0]);
  var g = Math.floor(cols[curback][1] * rr + rat * cols[curnext][1]);
  var b = Math.floor(cols[curback][2] * rr + rat * cols[curnext][2]);
  $(".myback").css('background-color','rgb('+r+','+g+','+b+')');
  rat+=0.02;
  if (rat>1) {
     rat=0;
     curback = curnext;
     if (++curnext>5) curnext=0;
     setTimeout(setback,1000);
  }
  else setTimeout(setback,100);
}


function jkinit()
{ var me = window.localStorage.getItem('me');
  if (!me) me='';
  if (me.length) {
   jQuery.mobile.changePage("#fampage", {transition: "flip"});
  }
  else {
     $("#p1").show();
  }
  setback();
}

function jlogout()
{  window.localStorage.removeItem('me');
   $("#p1").show();
   jQuery.mobile.changePage("#intropage", {transition: "flip"});
}

function jlogin()
{  url='http://famclub.com.au/login.php?email='+encodeURIComponent($("#email").val())+"&pwd="+encodeURIComponent($("#pwd").val());
console.log(url);
   $.ajax({url: url, 
    success : function(result) {
     console.log(result);
       var r = result.split('~');
       alert(r[0]);
       if (r[0]=='s') {
           window.localStorage.setItem('me',r[1]);
           window.localStorage.setItem('myname',r[2]);
           jQuery.mobile.changePage("#fampage", {transition: "flip"});
       }
       if (r[0]=='e') {
         $("#err").html(r[1]);
         $("#err").show();
         setTimeout(hideerr,1500);
       }
       if (r[0]=='n') {
          $("#em").html('<b>'+$("#email").val()+'</b>');
          $("#fname").val('');
          $("#lname").val('');
          $("#sub").val('');
alert('changing');
          jQuery.mobile.changePage("#regpage", {transition: "flip"});
       }
    }
   });
}

function hideerr()
{ $("#err").hide();
}

</script>
</head>
<body onload="jkinit()">

<div data-role="page" id="intropage" class="mypg myback">

 <div role="main" class="ui-content myback">
<div name="p1" id="p1" style="display:none">
<center>
<img src="logo.png" style="width:50%; margin-bottom:15px">
<br>
<a href="#tourpop" data-rel="popup" data-position-to="window" data-transition="fade" class="ui-btn ui-btn-inline ui-icon-navigation ui-btn-icon-right">Take a Tour of this App</a>
<br><br>-- or log in below --
</center>
<p><input type="email" name="email" id="email" placeholder="Your Email Address"></p>
<p><input type="password" name="pwd" id="pwd" placeholder="Password"></p>
<p>
<a href="jlogin()" class="ui-btn">LOG IN</a>
<br>
<div id="err" style="color:white; background-color:red; padding:3px;display:none">Error</div>
<br>
<center>
<img src="facebook.png" style="width:80%" onclick="dofacebooklogin()">
</center>
<div data-role="popup" id="tourpop">
 <a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>
 <p>Welcome to FamClub!</p>
 <p>Here our aim is to contribute to happy, smooth-running families where everybody feels that their needs and feelings are being considered and there is open dialogue between family members</p>
</div>

</div>
</div>
</div>

<div data-role="page" id="regpage" class="mypg myback">
 <div role="main" class="ui-content myback">
 <a href="jlogout()" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-back ui-btn-icon-notext ui-btn-right">Close</a>
<center>
<img src="logo.png" style="width:50%">
<br><br>
<p><b>New FamClub Member</b></p>
</center>
<p>We haven't seen that email address before.  Please enter your details below for email address :-<br>
<span id="em"></em></p>
<input type="text" name="fname" id="fname" placeholder="First Name">
<input type="text" name="lname" id="lname" placeholder="Last Name">
<input type="text" name="suburb" id="suburb" placeholder="Suburb or Town">
<input type="button" value="SIGN UP" onclick="register()">
</div>
</div>

<div data-role="page" id="fampage" class="mypg myback">
 <div role="main" class="ui-content myback">
<center>
<img src="logo.png" style="width:50%">
</center>
<p>Choose a Family</p>
<input type="button" value="LOG IN" onclick="alert(cols[1][2]);">

<div data-role="footer" onclick="jlogout()" data-fullscreen="true" data-position="fixed">
<h4>Log Out</h4>
</div>
 </div>
</div>

</body>
</html>